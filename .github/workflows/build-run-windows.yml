name: Build and Run Spring Boot App on Windows

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build-and-run:
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build with Maven
        run: mvn clean install

      - name: List JAR Files (for debug)
        run: dir target

      - name: Run Spring Boot JAR
        run: |
          $jar = Get-ChildItem -Path target -Filter "*.jar" | Select-Object -First 1
          java -jar "target\$($jar.Name)"
        shell: pwsh

      - name: Notify Success
        if: success()
        run: echo "Spring Boot app is running locally!"

      - name: Test home.html
        run: |
        java -jar target/your-app.jar &
        Start-Sleep -Seconds 10
        curl http://localhost:8081/home.html
        shell: pwsh

      - name: Notify Failure
        if: failure()
        run: echo "Build failed!"
